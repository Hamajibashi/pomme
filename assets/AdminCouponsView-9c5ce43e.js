import{S as _}from"./sweetalert2.all-27c1d80c.js";import{_ as x,r as p,o as a,c as d,b as e,d as l,w as k,n as b,D as $,I as D,M as w,i as L,f as B,T as E,F as M,h as T,t as v}from"./index-2b9cb732.js";import{P as U}from"./PaginationComponent-434bf017.js";import{D as N}from"./DeleteModal-1fb19c60.js";const S={props:["coupon","isNew"],emits:["update-coupon"],data(){return{tempCoupon:{},due_date:null}},watch:{coupon(){this.tempCoupon={...this.coupon,is_enabled:this.coupon.is_enabled||0};const s=new Date(this.tempCoupon.due_date*1e3).toLocaleDateString().split("T");[this.due_date]=s},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}}},A={class:"modal-dialog",role:"document"},I={class:"modal-content"},P={class:"modal-header bg-primary text-white"},H={class:"modal-title",id:"exampleModalLabel"},F={key:0},R={key:1},q=e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),j={class:"modal-body"},z={class:"mb-3"},O=e("label",{for:"title"},"標題",-1),G={class:"mb-3"},J=e("label",{for:"coupon_code"},"優惠碼",-1),K={class:"mb-3"},Q=e("label",{for:"due_date"},"到期日",-1),W={class:"mb-3"},X=e("label",{for:"price"},"折扣百分比",-1),Y={class:"mb-3"},Z={class:"form-check"},ee=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),oe=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-gray","data-bs-dismiss":"modal"},"取消"),e("button",{type:"submit",class:"btn btn-primary"},"確認")],-1);function te(s,o,i,h,t,c){const m=p("VeeField"),r=p("error-message"),g=p("VeeForm");return a(),d("div",A,[e("div",I,[e("div",P,[e("h5",H,[i.isNew?(a(),d("span",F,"新增優惠券")):(a(),d("span",R,"編輯優惠券"))]),q]),l(g,{ref:"form",onSubmit:o[5]||(o[5]=u=>s.$emit("update-coupon",t.tempCoupon))},{default:k(({errors:u})=>[e("div",j,[e("div",z,[O,l(m,{type:"text",name:"標題",class:b(["form-control",{"is-invalid":u.標題}]),id:"title",rules:"required",modelValue:t.tempCoupon.title,"onUpdate:modelValue":o[0]||(o[0]=n=>t.tempCoupon.title=n),placeholder:"請輸入標題"},null,8,["class","modelValue"]),l(r,{name:"標題",class:"invalid-feedback"})]),e("div",G,[J,l(m,{type:"text",name:"優惠碼",class:b(["form-control",{"is-invalid":u.優惠碼}]),id:"coupon_code",rules:"required",modelValue:t.tempCoupon.code,"onUpdate:modelValue":o[1]||(o[1]=n=>t.tempCoupon.code=n),placeholder:"請輸入優惠碼"},null,8,["class","modelValue"]),l(r,{name:"優惠碼",class:"invalid-feedback"})]),e("div",K,[Q,l(m,{type:"date",name:"到期日",class:b(["form-control",{"is-invalid":u.到期日}]),id:"due_date",rules:"required",modelValue:t.due_date,"onUpdate:modelValue":o[2]||(o[2]=n=>t.due_date=n)},null,8,["class","modelValue"]),l(r,{name:"到期日",class:"invalid-feedback"})]),e("div",W,[X,l(m,{type:"number",name:"折扣百分比",class:b(["form-control",{"is-invalid":u.折扣百分比}]),id:"price",min:"0",max:"100",oninput:"this.value = Math.abs(this.value)",rules:"required|max_value:99|min_value:1",modelValue:t.tempCoupon.percent,"onUpdate:modelValue":o[3]||(o[3]=n=>t.tempCoupon.percent=n),modelModifiers:{number:!0},placeholder:"請輸入折扣百分比"},null,8,["class","modelValue"]),l(r,{name:"折扣百分比",class:"invalid-feedback"})]),e("div",Y,[e("div",Z,[$(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=n=>t.tempCoupon.is_enabled=n),id:"is_enabled"},null,512),[[D,t.tempCoupon.is_enabled]]),ee])])]),oe]),_:1},512)])])}const ne=x(S,[["render",te]]),{VITE_BASEURL:f,VITE_APIPATH:C}={VITE_BASEURL:"https://vue3-course-api.hexschool.io",VITE_APIPATH:"hmjbs",BASE_URL:"/pomme/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},se={components:{PaginationComponent:U,DeleteModal:N,CouponModal:ne},data(){return{coupons:{},tempCoupon:[],pagination:{},isNew:!0,deleteModal:null,couponModal:null,isLoading:!1}},methods:{getCoupons(s=1){this.isLoading=!0;const o=`${f}/v2/api/${C}/admin/coupons?page=${s}`;this.axios.get(o).then(i=>{this.coupons=i.data.coupons,this.pagination=i.data.pagination,this.isLoading=!1}).catch(i=>{this.isLoading=!1,_.fire({iconColor:"#992525",iconHtml:'<i class="bi bi-exclamation-triangle-fill"></i>',text:`${i.response.data.message}`,showConfirmButton:!1,width:250,timer:1500})})},updateCoupon(s){let o=`${f}/v2/api/${C}/admin/coupon`,i="post";this.isNew||(o=`${f}/v2/api/${C}/admin/coupon/${s.id}`,i="put"),this.axios[i](o,{data:s}).then(h=>{_.fire({iconColor:"#004c34",iconHtml:'<i class="bi bi-check-circle-fill"></i>',text:`${h.data.message}`,showConfirmButton:!1,width:250,timer:1200}),this.couponModal.hide(),this.getCoupons()}).catch(h=>{_.fire({iconColor:"#992525",iconHtml:'<i class="bi bi-exclamation-triangle-fill"></i>',text:`${h.response.data.message}`,showConfirmButton:!1,width:250,timer:1500})})},deleteCoupon(){const s=`${f}/v2/api/${C}/admin/coupon/${this.tempCoupon.id}`;this.axios.delete(s).then(o=>{_.fire({iconColor:"#004c34",iconHtml:'<i class="bi bi-check-circle-fill"></i>',text:`${o.data.message}`,showConfirmButton:!1,width:250,timer:1200}),this.deleteModal.hide(),this.getCoupons()}).catch(o=>{_.fire({iconColor:"#992525",iconHtml:'<i class="bi bi-exclamation-triangle-fill"></i>',text:`${o.response.data.message}`,showConfirmButton:!1,width:250,timer:1500})})},openModal(s,o){s==="delete"?(this.tempCoupon={...o},this.deleteModal.show()):s==="edit"?(this.isNew=!1,this.tempCoupon={...o},this.couponModal.show()):s==="new"&&(this.isNew=!0,this.tempCoupon={imagesUrl:[]},this.couponModal.show())}},mounted(){this.getCoupons(),this.deleteModal=new w("#deleteModal"),this.couponModal=new w("#couponModal")}},le={class:"container p-5"},ie={class:"d-flex justify-content-between mb-4"},ae=e("h1",{class:"h2 fw-bold"},"優惠券管理",-1),de={class:"table mt-4"},ce=e("thead",null,[e("tr",null,[e("th",null,"名稱"),e("th",null,"折扣百分比"),e("th",null,"到期日"),e("th",null,"是否啟用"),e("th",null,"編輯")])],-1),ue={key:0,class:"text-success"},pe={key:1,class:"text-muted"},me={class:"btn-group"},re=["onClick"],he=["onClick"],_e={id:"couponModal",ref:"couponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},be={id:"deleteModal",ref:"deleteModal",class:"modal fade",tabindex:"-1","aria-labelledby":"deleteModalLabel","aria-hidden":"true"};function fe(s,o,i,h,t,c){const m=p("loading-component"),r=p("pagination-component"),g=p("coupon-modal"),u=p("delete-modal");return a(),d(M,null,[(a(),L(E,{to:"title"},[B(" | 優惠券管理")])),l(m,{active:t.isLoading,"z-index":1060},null,8,["active"]),e("div",le,[e("div",ie,[ae,e("button",{type:"button",class:"btn btn-primary",onClick:o[0]||(o[0]=n=>c.openModal("new"))}," 建立新的優惠券 ")]),e("table",de,[ce,e("tbody",null,[(a(!0),d(M,null,T(t.coupons,(n,y)=>(a(),d("tr",{key:y},[e("td",null,v(n.title),1),e("td",null,v(n.percent)+"%",1),e("td",null,v(s.$filters.date(n.due_date)),1),e("td",null,[n.is_enabled===1?(a(),d("span",ue,"啟用")):(a(),d("span",pe,"未啟用"))]),e("td",null,[e("div",me,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:V=>c.openModal("edit",n)},"編輯",8,re),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:V=>c.openModal("delete",n)},"刪除",8,he)])])]))),128))])]),l(r,{onEmitPages:c.getCoupons,pages:t.pagination},null,8,["onEmitPages","pages"]),e("div",_e,[l(g,{"is-new":t.isNew,coupon:t.tempCoupon,onUpdateCoupon:c.updateCoupon},null,8,["is-new","coupon","onUpdateCoupon"])],512),e("div",be,[l(u,{item:t.tempCoupon,onDelItem:c.deleteCoupon},null,8,["item","onDelItem"])],512)])],64)}const Me=x(se,[["render",fe]]);export{Me as default};
